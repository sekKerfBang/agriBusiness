{% extends 'base.html' %}
{% load static %}
{% load profile_tags %}{% block title %}Modifier le Profil de {{ user.username }} | AgriBusiness Pro{% endblock %}{% block extra_css %}
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0D3B1E;
      --secondary: #2D5F3F;
      --accent: #4A9D5E;
      --neutral: #6B7280;
      --dark: #0A0F0C;
      --text: #FFFFFF;
      --text-muted: #A0B0A8;
      --background: rgba(13, 59, 30, 0.1);
      --border: rgba(74, 157, 94, 0.2);
    }body {
  background: var(--dark);
  color: var(--text);
  font-family: 'Inter', sans-serif;
}

.edit-header {
  background: var(--primary);
  margin: -1rem -15px 3rem -15px;
  padding: 4rem 0;
  text-align: center;
}

.edit-title {
  font-size: 2.5rem;
  font-weight: 700;
  color: var(--text);
}

.edit-subtitle {
  font-size: 1.2rem;
  color: var(--text-muted);
  font-weight: 400;
}

.edit-card {
  background: var(--background);
  border-radius: 12px;
  padding: 3rem;
  border: 1px solid var(--border);
  box-shadow: 0 4px 12px rgba(0,0,0,0.2);
}

.form-group {
  margin-bottom: 2rem;
}

.form-label {
  display: block;
  font-size: 1.1rem;
  font-weight: 600;
  color: var(--green);
  margin-bottom: 0.75rem;
}

.form-control {
  background: rgba(255,255,255,0.05);
  border: 1px solid var(--border);
  border-radius: 8px;
  padding: 1rem 1.5rem;
  font-size: 1rem;
  color: var(--text);
  width: 100%;
}

.form-control:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px rgba(74, 157, 94, 0.1);
  outline: none;
}

.form-control-textarea {
  min-height: 150px;
  resize: vertical;
}

.form-check {
  display: flex;
  align-items: center;
  padding: 1rem;
  border-radius: 8px;
  border: 1px solid var(--border);
}

.form-check-input {
  width: 20px;
  height: 20px;
  margin-right: 1rem;
  accent-color: var(--accent);
}

.form-check-label {
  font-size: 1rem;
  font-weight: 500;
  color: var(--text);
}

.help-text {
  display: block;
  margin-top: 0.5rem;
  color: var(--#303);
  font-size: 0.9rem;
}

.producer-section {
  background: rgba(74, 157, 94, 0.05);
  border-left: 4px solid var(--accent);
  border-radius: 12px;
  padding: 3rem;
  margin-top: 4rem;
}

.section-title {
  font-size: 1.8rem;
  font-weight: 600;
  color: var(--green);
  margin-bottom: 2rem;
}

.btn-group {
  display: flex;
  gap: 2rem;
  justify-content: center;
  margin-top: 4rem;
}

.btn-save {
  background: var(--accent);
  border: none;
  border-radius: 8px;
  padding: 1.2rem 3rem;
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--text);
  cursor: pointer;
  transition: background 0.3s ease;
}

.btn-save:hover {
  background: #3E8A50;
}

.btn-cancel {
  background: transparent;
  border: 2px solid var(--neutral);
  border-radius: 8px;
  padding: 1.2rem 3rem;
  font-weight: 600;
  font-size: 1.1rem;
  color: var(--neutral);
  transition: all 0.3s ease;
}

.btn-cancel:hover {
  border-color: var(--text);
  color: var(--text);
}

.error-text {
  color: var(--danger);
  font-size: 0.9rem;
  margin-top: 0.5rem;
}

/* Responsive */
@media (max-width: 992px) {
  .edit-title { font-size: 2.2rem; }
  .edit-card { padding: 2.5rem; }
}

@media (max-width: 768px) {
  .edit-title { font-size: 2rem; }
  .edit-card { padding: 2rem; }
  .btn-group { flex-direction: column; gap: 1.5rem; }
}  </style>
{% endblock %}{% block content %}<div class="edit-header">
  <div class="container">
    <h1 class="edit-title">Modifier le Profil</h1>
    <p class="edit-subtitle">Mettez √† jour vos informations professionnelles</p>
  </div>
</div>

<div class="container">
  <div class="edit-card">
    <form method="post" enctype="multipart/form-data" id="profileForm">
      {% csrf_token %}

  <!-- INFORMATIONS PERSONNELLES -->
  <div class="row">
    <div class="col-lg-6">
      <h3 class="section-title">
        <i class="fas fa-user"></i> Identit√© et Coordonn√©es
      </h3>

      {% for field in form.visible_fields %}
        {% if field.name in 'username,phone,location,email' %}
          <div class="form-group">
            <label for="{{ field.id_for_label }}" class="form-label">
              {{ field.label }}
            </label>
            {{ field }}
            {% if field.help_text %}
              <small class="help-text">{{ field.help_text }}</small>
            {% endif %}
            {% if field.errors %}
              <div class="error-text">
                <i class="fas fa-exclamation-circle"></i> {{ field.errors.0 }}
              </div>
            {% endif %}
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <div class="col-lg-6">
      <h3 class="section-title">
        <i class="fas fa-lock"></i> S√©curit√©
      </h3>

      <div class="form-group">
        <label for="id_password" class="form-label">
          Nouveau mot de passe
        </label>
        <input type="password" name="password" id="id_password" class="form-control" placeholder="Laissez vide pour conserver l'actuel">
        <small class="help-text">Au moins 8 caract√®res, incluant une majuscule, un chiffre et un symbole</small>
      </div>

      <div class="form-group">
        <label for="id_confirm_password" class="form-label">
          Confirmer le mot de passe
        </label>
        <input type="password" name="confirm_password" id="id_confirm_password" class="form-control" placeholder="R√©p√©tez le nouveau mot de passe">
      </div>
    </div>
  </div>

  <!-- PROFIL PRODUCTEUR -->
  {% if user.is_entreprise %}
  <div class="producer-section">
    <h3 class="section-title">
      <i class="fas fa-tractor"></i> Profil Producteur
    </h3>

    <div class="form-group">
      <div class="form-check">
        {{ form.is_organic }}
        <label for="{{ form.is_organic.id_for_label }}" class="form-check-label">
          Certification Agriculture Biologique
        </label>
      </div>
      <small class="help-text">S√©lectionnez si votre exploitation est certifi√©e AB</small>
    </div>

    <div class="form-group">
      <label for="{{ form.description.id_for_label }}" class="form-label">
        Description de l'exploitation
      </label>
      {{ form.description }}
      <small class="help-text">Pr√©sentez votre exploitation, vos m√©thodes et vos valeurs</small>
    </div>

    <div class="form-group">
      <label for="{{ form.certifications.id_for_label }}" class="form-label">
        Autres certifications
      </label>
      {{ form.certifications }}
      <small class="help-text">Exemples : AOP, IGP, HVE, Label Rouge</small>
    </div>
  </div>
  {% endif %}

  <!-- ACTIONS -->
  <div class="btn-group">
    <button type="submit" class="btn-save">
      Enregistrer les modifications
    </button>
    <a href="{% url 'utilisateur:profile' %}" class="btn-cancel">
      Annuler
    </a>
  </div>
</form>  </div>
</div>

<!-- Toast de succ√®s -->
<div class="toast" role="alert" aria-live="assertive" aria-atomic="true" style="position: fixed; bottom: 1rem; right: 1rem; background: var(--accent); color: var(--text); border-radius: 8px; padding: 1rem 1.5rem; min-width: 300px; opacity: 0; transition: opacity 0.3s ease;">
  <div class="toast-body">
    <strong>Profil mis √† jour</strong>
    <p>Vos modifications ont √©t√© enregistr√©es.</p>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('profileForm');
      const toast = document.querySelector('.toast');  // Validation basique
  form.addEventListener('submit', function(e) {
    const password = document.getElementById('id_password').value;
    const confirmPassword = document.getElementById('id_confirm_password').value;

    if (password && password !== confirmPassword) {
      e.preventDefault();
      alert('Les mots de passe ne correspondent pas.');
      return;
    }

    // Afficher toast (simul√©)
    toast.style.opacity = '1';
    setTimeout(() => {
      toast.style.opacity = '0';
    }, 3000);
  });

  // Compteur pour textareas
  const textareas = form.querySelectorAll('textarea');
  textareas.forEach(ta => {
    const counter = document.createElement('small');
    counter.className = 'help-text';
    ta.parentNode.appendChild(counter);
    ta.addEventListener('input', () => {
      counter.textContent = `${ta.value.length} caract√®res`;
    });
    counter.textContent = `${ta.value.length} caract√®res`;
  });
});  </script>
{% endblock %}






{% comment %} {% extends 'base.html' %}
{% load static %}
{% load profile_tags %}

{% block title %}√âditer {{ user.username }} | AgriBusiness Pro{% endblock %}

{% block extra_css %}
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #0D3B1E;
      --secondary: #2D5F3F;
      --accent: #4A9D5E;
      --gold: #D4AF37;
      --danger: #C92A2A;
      --dark: #0A0F0C;
      --text: #FFFFFF;
      --text-muted: #A0B0A8;
      --glass: rgba(13, 59, 30, 0.4);
    }

    body {
      background: radial-gradient(ellipse at center, var(--dark) 0%, #000000 100%);
      color: var(--text);
      font-family: 'Inter', sans-serif;
    }

    .edit-header {
      background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
      margin: -2rem -15px 5rem -15px;
      padding: 6rem 0 5rem;
      position: relative;
      overflow: hidden;
    }

    .edit-title {
      font-family: 'Playfair Display', serif;
      font-size: 4rem;
      font-weight: 900;
      color: var(--text);
      text-shadow: 0 5px 20px rgba(0,0,0,0.7);
    }

    .edit-subtitle {
      font-size: 1.4rem;
      color: var(--text-muted);
      font-weight: 300;
      letter-spacing: 3px;
      text-transform: uppercase;
    }

    .edit-card {
      background: var(--glass);
      backdrop-filter: blur(20px);
      border-radius: 30px;
      padding: 5rem;
      border: 1px solid rgba(74, 157, 94, 0.3);
      box-shadow: 0 25px 80px rgba(0,0,0,0.6);
      margin-bottom: 4rem;
    }

    /* ====== CHAMPS PREMIUM ====== */
    .form-group {
      margin-bottom: 4rem;
      position: relative;
    }

    .form-label {
      display: block;
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--green);
      margin-bottom: 1.5rem;
      text-transform: uppercase;
      letter-spacing: 2px;
      position: relative;
      padding-left: 2rem;
    }

    .form-label::before {
      content: '';
      position: absolute;
      left: 0;
      top: 50%;
      transform: translateY(-50%);
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--accent);
    }

    .form-control {
      background: rgba(0,0,0,0.4);
      border: 2px solid rgba(74, 157, 94, 0.4);
      border-radius: 14px;
      padding: 1.5rem 2rem;
      font-size: 1.3rem;
      color: var(--text);
      font-weight: 500;
      transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
      width: 100%;
    }

    .form-control:focus {
      background: rgba(239, 233, 233, 0.94);
      border-color: var(--accent);
      box-shadow: 0 0 0 4px rgba(74, 157, 94, 0.3), 0 8px 30px rgba(74, 157, 94, 0.4);
      outline: none;
      transform: translateY(-5px);
    }

    .form-control-textarea {
      min-height: 200px;
      resize: vertical;
      font-family: inherit;
    }

    /* Checkbox luxe */
    .form-check {
      padding: 2rem;
      background: var(--glass);
      border-radius: 14px;
      margin-bottom: 3rem;
      border: 1px solid rgba(74, 157, 94, 0.2);
      transition: all 0.3s ease;
    }

    .form-check:hover {
      border-color: var(--accent);
      transform: translateX(15px);
    }

    .form-check-input {
      width: 24px;
      height: 24px;
      margin-right: 1.5rem;
      cursor: pointer;
      accent-color: var(--white);
    }

    .form-check-label {
      font-size: 1.3rem;
      font-weight: 600;
      color: var(--white);
      cursor: pointer;
    }

    .help-text {
      display: block;
      margin-top: 1rem;
      color: var(--white);
      font-size: 1.1rem;
      font-style: italic;
      padding-left: 2rem;
      position: relative;
    }

    .help-text::before {
      content: 'üí°';
      position: absolute;
      left: 0;
    }

    /* Section producteur */
    .producer-section {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(74, 157, 94, 0.1) 100%);
      border-left: 6px solid var(--gold);
      border-radius: 20px;
      padding: 4rem;
      margin-top: 6rem;
      position: relative;
    }

    .producer-section::before {
      content: '‚ú¶ PRODUCTEUR ‚ú¶';
      position: absolute;
      top: -18px;
      left: 2rem;
      background: var(--gold);
      color: var(--dark);
      padding: 0.8rem 2rem;
      border-radius: 50px;
      font-weight: 800;
      font-size: 0.9rem;
      letter-spacing: 2px;
    }

    .section-title {
      color: var(--green);
      font-family: 'Playfair Display', serif;
      font-size: 2.2rem;
      font-weight: 900;
      margin-bottom: 3rem;
    }

    /* Boutons */
    .btn-group {
      display: flex;
      gap: 3rem;
      justify-content: center;
      margin-top: 6rem;
      flex-wrap: wrap;
    }

    .btn-save {
      background: linear-gradient(135deg, var(--accent), var(--secondary), var(--accent));
      background-size: 200% 200%;
      border: none;
      border-radius: 18px;
      padding: 1.8rem 4rem;
      font-weight: 900;
      font-size: 1.4rem;
      color: var(--text);
      cursor: pointer;
      transition: all 0.5s ease;
      box-shadow: 0 15px 40px rgba(74, 157, 94, 0.6);
      letter-spacing: 1px;
      min-width: 280px;
      position: relative;
      overflow: hidden;
    }

    .btn-save:hover {
      background-position: 100% 100%;
      transform: translateY(-8px) scale(1.05);
      box-shadow: 0 20px 50px rgba(74, 157, 94, 0.8);
    }

    .btn-save::before {
      content: '';
      position: absolute;
      top: 0; left: -100%;
      width: 100%; height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: 0.6s;
    }

    .btn-save:hover::before {
      left: 100%;
    }

    .btn-cancel {
      background: transparent;
      border: 3px solid var(--text-muted);
      border-radius: 18px;
      padding: 1.8rem 4rem;
      font-weight: 900;
      font-size: 1.4rem;
      color: var(--text-muted);
      cursor: pointer;
      transition: all 0.4s ease;
      min-width: 280px;
      text-decoration: none;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
    }

    .btn-cancel:hover {
      border-color: var(--text);
      color: var(--text);
      background: rgba(255,255,255,0.05);
      transform: translateY(-3px);
    }

    /* Animations */
    @keyframes fadeInUp {
      from { opacity: 0; transform: translateY(50px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .animate-in {
      animation: fadeInUp 0.8s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .form-group:nth-child(1) { animation-delay: 0.1s; }
    .form-group:nth-child(2) { animation-delay: 0.2s; }
    .form-group:nth-child(3) { animation-delay: 0.3s; }

    /* Responsive */
    @media (max-width: 992px) {
      .edit-title { font-size: 3.5rem; }
      .edit-card { padding: 3.5rem; }
      .btn-group { flex-direction: column; align-items: center; }
    }

    @media (max-width: 768px) {
      .edit-title { font-size: 2.8rem; }
      .edit-card { padding: 2.5rem; }
      .form-group { margin-bottom: 3rem; }
      .producer-section { padding: 2.5rem; margin-top: 4rem; }
      .btn-group { gap: 2rem; margin-top: 4rem; }
    }
  </style>
{% endblock %}

{% block content %}
<div class="edit-header">
  <div class="container text-center">
    <h1 class="edit-title animate-in">√âditer Profil</h1>
    <p class="edit-subtitle animate-in">Personnalisez votre identit√© professionnelle</p>
  </div>
</div>

<div class="container">
  <div class="edit-card">
    <form method="post" enctype="multipart/form-data" id="profileForm">
      {% csrf_token %}
      
      <!-- INFORMATIONS PERSONNELLES -->
      <div class="row">
        <div class="col-lg-6">
          <h3 class="section-title animate-in">
            <i class="fas fa-user-circle"></i> Identit√©
          </h3>

          {% for field in form.visible_fields %}
            {% if field.name in 'phone,location,email' %}
              <div class="form-group animate-in">
                <label for="{{ field.id_for_label }}" class="form-label">
                  <i class="fas fa-{{ field|get_icon }}"></i> {{ field.label }}
                </label>
                {{ field }}
                {% if field.help_text %}
                  <small class="help-text">{{ field.help_text }}</small>
                {% endif %}
                {% if field.errors %}
                  <div class="error-text">
                    <i class="fas fa-exclamation-circle"></i> {{ field.errors.0 }}
                  </div>
                {% endif %}
              </div>
            {% endif %}
          {% endfor %}
        </div>

        <div class="col-lg-6">
          <h3 class="section-title animate-in">
            <i class="fas fa-shield-alt"></i> S√©curit√©
          </h3>

          <!-- Password fields (manually added or loop through) -->
          <div class="form-group animate-in">
            <label for="id_password" class="form-label">
              <i class="fas fa-key"></i> Nouveau mot de passe
            </label>
            <input type="password" name="password" id="id_password" class="form-control" placeholder="Laissez vide pour conserver">
            <small class="help-text">8+ caract√®res, majuscule, chiffre et symbole</small>
          </div>

          <div class="form-group animate-in">
            <label for="id_confirm_password" class="form-label">
              <i class="fas fa-key"></i> Confirmer mot de passe
            </label>
            <input type="password" name="confirm_password" id="id_confirm_password" class="form-control">
          </div>
        </div>
      </div>

      <hr class="section-divider">

      <!-- PROFIL PRODUCTEUR -->
      {% if user.is_entreprise %}
      <div class="producer-section animate-in">
        <h3 class="section-title">
          <i class="fas fa-tractor"></i> Profil Producteur
        </h3>

        <div class="form-group">
          <div class="form-check">
            {{ form.is_organic }}
            <label for="{{ form.is_organic.id_for_label }}" class="form-check-label">
              <i class="fas fa-leaf"></i> Certification Agriculture Biologique
            </label>
            <small class="help-text">Cochez si votre exploitation est certifi√©e AB</small>
          </div>
        </div>

        <div class="form-group">
          <label for="{{ form.description.id_for_label }}" class="form-label">
            <i class="fas fa-align-left"></i> Description de l'exploitation
          </label>
          {{ form.description }}
          <small class="help-text">Pr√©sentez votre histoire, vos valeurs et m√©thodes</small>
        </div>

        <div class="form-group">
          <label for="{{ form.certifications.id_for_label }}" class="form-label">
            <i class="fas fa-certificate"></i> Autres certifications
          </label>
          {{ form.certifications }}
          <small class="help-text">AOP, IGP, Label Rouge, etc.</small>
        </div>
      </div>
      {% endif %}

      <!-- ACTIONS -->
      <div class="btn-group animate-in">
        <button type="submit" class="btn-save">
          <i class="fas fa-save"></i> Enregistrer les modifications
        </button>
        <a href="{% url 'utilisateur:profile' %}" class="btn-cancel">
          <i class="fas fa-times"></i> Annuler
        </a>
      </div>
    </form>
  </div>
</div>

<!-- Toast de succ√®s -->
<div class="toast" role="alert" style="position: fixed; bottom: 2rem; right: 2rem; background: var(--accent); color: white; border-radius: 15px; padding: 1.5rem 2rem; min-width: 350px; opacity: 0; transform: translateY(100px); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 9999;">
  <div class="toast-body" style="display: flex; align-items: center; gap: 1rem;">
    <i class="fas fa-check-circle" style="font-size: 2rem;"></i>
    <div>
      <strong>Profil mis √† jour !</strong>
      <div style="font-size: 0.9rem; opacity: 0.9;">Vos modifications ont √©t√© sauvegard√©es</div>
    </div>
  </div>
</div>
{% endblock %}

{% block extra_js %}
  <script>
    // Features premium :
    // 1. Validation en temps r√©el
    // 2. Animation au scroll
    // 3. Toast de succ√®s
    // 4. Character counter
    
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('profileForm');
      const inputs = form.querySelectorAll('.form-control');
      
      // Validation live
      inputs.forEach(input => {
        input.addEventListener('blur', function() {
          if (this.value.trim()) {
            this.classList.add('is-valid');
            this.classList.remove('is-invalid');
          } else {
            this.classList.remove('is-valid');
          }
        });
        
        // Focus premium
        input.addEventListener('focus', function() {
          this.parentElement.style.transform = 'scale(1.03)';
          this.parentElement.style.zIndex = '10';
        });
        
        input.addEventListener('blur', function() {
          this.parentElement.style.transform = '';
          this.parentElement.style.zIndex = '';
        });
      });

      // Submit with toast
      form.addEventListener('submit', function(e) {
        e.preventDefault(); // Remove in production
        
        const toast = document.querySelector('.toast');
        toast.style.opacity = '1';
        toast.style.transform = 'translateY(0)';
        
        setTimeout(() => {
          toast.style.opacity = '0';
          toast.style.transform = 'translateY(100px)';
        }, 4000);
      });
      
      // Character counter
      const textareas = document.querySelectorAll('.form-control-textarea');
      textareas.forEach(ta => {
        const counter = document.createElement('div');
        counter.className = 'char-counter';
        counter.style.cssText = 'text-align: right; color: var(--text-muted); font-size: 0.9rem; margin-top: 0.5rem; font-weight: 500;';
        ta.parentNode.appendChild(counter);
        
        ta.addEventListener('input', function() {
          counter.textContent = `${this.value.length} caract√®res`;
        });
      });
    });
  </script>
{% endblock %} {% endcomment %}
